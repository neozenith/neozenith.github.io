<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Python Testing | Josh Peak - ☕ Release Valve</title>
    <meta name="description" content="Documenting the rabbit hole of testing tools and options in Python">
    <link rel="icon" href="/images/favicon.ico">
    <meta property="og:image" content="/images/books.jpg"><meta property="og:image:type" content="undefined"><meta property="og:image:width" content="undefined"><meta property="og:image:height" content="undefined"><meta property="og:image:alt" content="undefined"><meta name="twitter:image" content="/images/books.jpg"><meta itemprop="image" content="/images/books.jpg"><meta property="og:description" content="Documenting the rabbit hole of testing tools and options in Python"><meta name="twitter:description" content="Documenting the rabbit hole of testing tools and options in Python"><meta itemprop="description" content="Documenting the rabbit hole of testing tools and options in Python"><meta property="og:url" content="https://joshpeak.net/posts/2019-06-18-Advanced-python-testing.html"><meta name="twitter:url" content="https://joshpeak.net/posts/2019-06-18-Advanced-python-testing.html"><meta property="og:title" content="Advanced Python Testing"><meta name="twitter:title" content="Advanced Python Testing"><meta itemprop="name" content="Advanced Python Testing"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta property="og:site_name" content="Josh Peak - Data Scientist">
    <link rel="preload" href="/assets/css/0.styles.7652b5e6.css" as="style"><link rel="preload" href="/assets/js/app.9eca36fc.js" as="script"><link rel="preload" href="/assets/js/2.5a99314c.js" as="script"><link rel="preload" href="/assets/js/14.49a54d24.js" as="script"><link rel="prefetch" href="/assets/js/10.295c9de1.js"><link rel="prefetch" href="/assets/js/11.0d325bef.js"><link rel="prefetch" href="/assets/js/12.798b1449.js"><link rel="prefetch" href="/assets/js/13.0ade80d8.js"><link rel="prefetch" href="/assets/js/15.06802f9d.js"><link rel="prefetch" href="/assets/js/16.e8e36db7.js"><link rel="prefetch" href="/assets/js/17.4e87ba93.js"><link rel="prefetch" href="/assets/js/18.17b53827.js"><link rel="prefetch" href="/assets/js/19.ff3ad037.js"><link rel="prefetch" href="/assets/js/3.4a86940c.js"><link rel="prefetch" href="/assets/js/4.a83a2c69.js"><link rel="prefetch" href="/assets/js/5.c4dccce7.js"><link rel="prefetch" href="/assets/js/6.00cbd8eb.js"><link rel="prefetch" href="/assets/js/7.8cbc6891.js"><link rel="prefetch" href="/assets/js/8.860bc426.js"><link rel="prefetch" href="/assets/js/9.6eea5330.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7652b5e6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Josh Peak - ☕ Release Valve</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Posts</a></div><div class="nav-item"><a href="https://au.linkedin.com/in/neozenith" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/neozenith" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">Posts</a></div><div class="nav-item"><a href="https://au.linkedin.com/in/neozenith" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/neozenith" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><div align="center"><img src="/images/books.jpg" alt="Reference books on my desk"></div> <h1 id="page-title"><a href="#page-title" aria-hidden="true" class="header-anchor">#</a> Advanced Python Testing</h1> <p><span style="color:#999;">26 min read...</span></p> <p>This article is mostly for me to process my thoughts but also to pave a path for anyone that wants to follow a similar journey on some more advanced python testing topics.</p> <p>I recently had the opportunity to <em>garbage collect</em>  a bunch of common libraries at my company into a new python library and git repository. Marking all the critical path libraries and copying them over, and sweeping away the unused cruft.</p> <p>This meant instituting some open source practices of <a href="#basci-code-quality">code quality</a> around our core library like testing.</p> <p>One of the main hurdles I hit was that our API wrapper code was flaky. It would randomly fail and it meant no-one trusted the tests.</p> <p>The problem was that the existing tests were designed to test the underlying database/API instead of the wrapper code itself. Thanks to <a href="https://twitter.com/brianokken/status/1140499269905870848" target="_blank" rel="noopener noreferrer">some help on twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> I landed on <a href="https://pypi.org/project/pytest-vcr/" target="_blank" rel="noopener noreferrer"><code>pytest-vcr</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>I guess I'm adhereing to <a href="https://twitter.com/kvlly/status/1139912868307066880?s=21" target="_blank" rel="noopener noreferrer">Twitter Driven Development<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div align="center"><img src="/images/tdd.jpg" alt="In response to 'what is your worst programming advice: Twitter Driven Development" width="50%"></div> <p>It creates <code>.yml</code> files to record the http requests per test on the first run, then replays them on subsequent runs of the test. Any request that doesn't match what was previously recorded is a failure as it is malformed from the expectation. It's easy to re-record a new expectation of requests per test too! Since it replays the request, it also allows the existing test assertions about the validity of the reponse to suffice too.</p> <p>That's the <strong>tl;dr</strong> but feel free to read through the rest of the narrative or just check out the <a href="#references">list of references</a> at the end.</p> <h1 id="contents"><a href="#contents" aria-hidden="true" class="header-anchor">#</a> Contents</h1> <p>The article is laid out in a few main sections:</p> <ul><li><a href="#overview">Overview</a>: If you only have a few minutes</li> <li><a href="#background-about-me">Background About Me</a>: Feel free to skip, but it gives context about my motivation.</li> <li><a href="#training-montage">Training Montage</a>: Narrative around some very helpful learning resources</li> <li><a href="#basic-code-quality">Basic Code Quality</a>: If you are new to software engineering and testing, please read.</li> <li><a href="#advanced-testing">Advanced Testing</a>: Leveraging Mocks, Stubs, Spies, Monkey Patches and Fixtures.</li> <li><a href="#conclusion">Conclusion</a>: My key take aways if you only have 5 minutes.</li> <li><a href="#references">References</a>: Links to all resources mentioned.</li></ul> <h1 id="background-about-me"><a href="#background-about-me" aria-hidden="true" class="header-anchor">#</a> Background About Me</h1> <p>A little about me though, I'm a Software Engineer and recently qualified Data Scientist working for Komatsu mining.</p> <blockquote><p>DISCLAIMER: All views expressed here are my own and do not reflect that of my current employer or any former companies or organisations I have been affiliated with.</p></blockquote> <p><strong>2010-2016</strong></p> <p>With that out of the way, I was a data engineer for a startup (2010-2016) using Python for our ETL heavily. So much so I gave a talk about <a href="/posts/2016-11-12-unit-test-data.html">Unit Testing Data</a>.</p> <p>I also tried to contribute to the AWS python SDK and that is when I learnt the value of automating open source projects. My code had to automatically pass a litany of testing and the test coverage wasn't allowed to regress lower then where it started.</p> <p><strong>If and only if</strong> I passed all these requirements would a real human start checking my PR! This is a much better use human effort.</p> <p>Even if it wasn't AWS, but a volunteer open source project, this sort of automation is like having robot colleagues to help your project stay on track! Volunteer time is often time away from family. So the 2-3 hours you do have on a project each week are precious so you want them to be of the most value.</p> <p>This is something that stuck with me and I will touch on further below in <a href="#basic-code-quality">Basic Code Quality</a>. Why don't corporations take on these practices? I often ask:</p> <blockquote><p>Would you volunteer on this code base?</p></blockquote> <p><strong>2016-2018</strong></p> <p>Between 2016-2018 I worked as a Software engineer at <a href="https://www.cloudsense.com/" target="_blank" rel="noopener noreferrer">CloudSense<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which has by far the most impressive code base I have ever worked on.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> clone <span class="token operator">&lt;</span>private <span class="token function">git</span> repo host<span class="token operator">&gt;</span>

<span class="token comment"># Login into private container registry and npm registry</span>
docker login
<span class="token function">npm</span> login

<span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> <span class="token builtin class-name">test</span>
</code></pre></div><p>In under 15 minutes of my first day, they had pulled down the source code, built the API server container and MongoDB, Redis and PostgreSQL fixture containers. They're test suite async-awaited the services to start up as fixtures then ran and cleaned up.</p> <p>All with code coverage above 80%. Since they integrate with Salesforce, Salesforce enforces 75% code coverage for all Apex code that gets deployed, so CloudSense set the bar higher to allow a buffer.</p> <p><strong>2019</strong></p> <p>Fast forward to 2019 and I've been with Komatsu for almost a year and have studied a Graduate Diploma of Data Science. The importance of designing statistical experiment,is by far the most important lesson I learned with the lens of a Software Engineer. When ever I'm modifying code or debugging I'm 10x faster by being deliberate about what I'm about to test. A failure or a new error message is information to learn from. So automating tests significantly reduces to cost and cycle time to getting answers.</p> <p>That said, 2016-2018 I was away from the Python ecosystem and I needed to catch up for this new role at Komatsu. So below I'm going to list the resources that were critical in my <a href="#training-montage">Training Montage</a></p> <h1 id="training-montage"><a href="#training-montage" aria-hidden="true" class="header-anchor">#</a> Training Montage</h1> <p>Having to catch up on 2 years of Python is no mean feat. Also Software Engineering is like music theory. You don't have to relearn everything, for each new instrument. Python, Node.JS, C++, etc... these are the instruments.</p> <p>The three main areas that were helpful were Podcasts, Tutorials and books.</p> <h2 id="podcasts"><a href="#podcasts" aria-hidden="true" class="header-anchor">#</a> Podcasts</h2> <div align="center"><img src="/images/pycon2019-podcasts.jpg" alt="PyCon2019: Me with the podcast hosts Brian Okken and Michael Kennedy" height="200"></div> <p>So the first step to catching up on 2 years is downloading the 2 year back catalog of the folowing podcasts:</p> <ul><li><a href="https://talkpython.fm/" target="_blank" rel="noopener noreferrer">Talk Python to Me<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://testandcode.com/" target="_blank" rel="noopener noreferrer">Test and Code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pythonbytes.fm/" target="_blank" rel="noopener noreferrer">Python Bytes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>In around 8 weeks of commuting to work, mowing the lawn and ironing shirts I caught up. Also listening at 1.5x speed is your friend. I was lucky enough to attend PyCon2019 and meet the hosts Brian Okken and Michael Kennedy and thank them.</p> <h2 id="real-python-articles"><a href="#real-python-articles" aria-hidden="true" class="header-anchor">#</a> Real Python articles</h2> <div align="center"><img src="/images/pycon2019-realpython.jpg" alt="PyCon2019: Me with the Real Python team, Dan Bader and Geir Arne Hjelle" height="200"></div> <p>The team at <a href="https://realpython.com/" target="_blank" rel="noopener noreferrer">Real Python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> are absolutely killing it with Python educational materials. I love how they have standardised on an article format and are pushing new articles every week.</p> <p>I would get into work an hour before everyone else, sit down with a coffee and read through an article everyday until I felt the gaps had been filled.</p> <ul><li><a href="https://realpython.com/pypi-publish-python-package/" target="_blank" rel="noopener noreferrer">Real Python: Packaging a Python Library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://realpython.com/pipenv-guide/" target="_blank" rel="noopener noreferrer">Real Python: A guide to Pipenv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://realpython.com/python-testing/#testing-in-multiple-environments" target="_blank" rel="noopener noreferrer">Real Python: Automated Testing - Multiple Environments<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://realpython.com/python-mock-library/" target="_blank" rel="noopener noreferrer">Real Python: Python Mock Library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="python-testing-with-pytest-book"><a href="#python-testing-with-pytest-book" aria-hidden="true" class="header-anchor">#</a> Python Testing with PyTest book</h2> <div align="center"><img src="/images/bopytest.jpg" alt="Book Cover: Python Testing with pytest - Brian Okken" height="200"></div> <p>Whilst I was at PyCon I thought I'd grab a physical copy of the <a href="https://pragprog.com/book/bopytest/python-testing-with-pytest" target="_blank" rel="noopener noreferrer">Python Testing with pytest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> book for the office thinking I wouldn't need it since I'd already gone pretty deep into python and pytest already.</p> <blockquote><p>NARRATOR: He was wrong.</p></blockquote> <p>So I decided if I was going to inflict this upon my colleagues I should read it myself. The first 3 chapters are a minimum for everyday use. The last 4 chapters were the crucial knowledge of fixtures and plugins that really blew my mind on what pytest could do and how extensible the platform is.</p> <p>Ok, montage complete! Now to test some things.</p> <h1 id="basic-code-quality"><a href="#basic-code-quality" aria-hidden="true" class="header-anchor">#</a> Basic Code Quality</h1> <p>Have you ever worked on a code base that looks like a patchwork of conflicting code styles and nothing is consistent?</p> <p>Ever worked on a code base that is just beautiful and consistent?</p> <p><a href="https://en.wikipedia.org/wiki/Cognitive_load" target="_blank" rel="noopener noreferrer">Cognitive Load<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is how fat the pipe is for our mental bandwidth to download new information. Just like reading XML versus JSON as a human, the extra symbols take more space over the wire, they take more cognitive load to process.</p> <p>Inconsistent styles are breaks in our understanding of the grammmar of information presented which adds unnecessary cognitive load and less attention span to detect the actual gnarly bugs.</p> <p>It's funny how to motivate people about code quality though.</p> <p>Person to person nag them and they'll ignore you.</p> <p>However a bot that flat out blocks their PR until it they perform some basic code hygiene, whilst a boss is breathing down their neck to hit timelines.... and then it gets done.</p> <p>I like to call this <em>getting someone stuck between a boss and a not so hard place</em>.</p> <h2 id="a-basic-test"><a href="#a-basic-test" aria-hidden="true" class="header-anchor">#</a> A basic test</h2> <p>Just so we are clear, here is a basic example of a pytest test:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>config <span class="token keyword">import</span> Config
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>datawarehouse <span class="token keyword">import</span> DataWarehouse

<span class="token keyword">class</span> <span class="token class-name">TestDataWarehouse</span><span class="token punctuation">:</span>
    
    @pytest<span class="token punctuation">.</span>fixture
    <span class="token keyword">def</span> <span class="token function">dwh_config</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>


    @pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize<span class="token punctuation">(</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;NamesOnly&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;All&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_get_all_metrics</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dwh_config<span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Given</span>
        dwh <span class="token operator">=</span> DataWarehouse<span class="token punctuation">(</span>envir<span class="token operator">=</span>dwh_config<span class="token punctuation">)</span>

        <span class="token comment"># When</span>
        results <span class="token operator">=</span> dwh<span class="token punctuation">.</span>get_all_metrics<span class="token punctuation">(</span>name_only<span class="token operator">=</span>names<span class="token punctuation">)</span>

        <span class="token comment"># Then</span>
        <span class="token keyword">assert</span> results <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span>

</code></pre></div><p>Here the test is <code>test_get_all_metrics</code>.</p> <p>It pulls in the <code>dwh_config</code> <a href="#fixtures">fixture</a> which I'll cover later.</p> <p>It also uses <a href="https://docs.pytest.org/en/latest/parametrize.html" target="_blank" rel="noopener noreferrer"><code>pytest</code>'s parametrizing decorator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to run the same test multiple times with different data configurations.</p> <p>The key practice that makes testing really really easy is the <em>Given/When/Then</em> framework which makes the process of writing tests calmingly methodic and digestable.</p> <h3 id="given"><a href="#given" aria-hidden="true" class="header-anchor">#</a> Given</h3> <p>Everything I need to setup a test. This can consist of test data but also of setting up a database connection using <a href="#fixtures">fixtures</a> which I promise I'll cover later. The distinction I like is that fixtures return <code>ERROR</code>s where as tests throw <code>FAIL</code>s.</p> <h3 id="when"><a href="#when" aria-hidden="true" class="header-anchor">#</a> When</h3> <p>The part of the code under test. I try to make this section one line of code so it is really clear what is being tested and how a user would write the same line of code. It forces me to think about the Developer Experience (DX) of the API design.</p> <h3 id="then"><a href="#then" aria-hidden="true" class="header-anchor">#</a> Then</h3> <p>This is the part where you confirm your expectations. Aim for proprty based aspects instead of fixed values. This might mean you have to sharpen your knowledge of metaprogramming methods like <code>isinstance</code>.</p> <h2 id="autoformatting"><a href="#autoformatting" aria-hidden="true" class="header-anchor">#</a> Autoformatting</h2> <p>One of the best inventions in the last few years are autoformatters. I think it started with <a href="https://golang.org/cmd/gofmt/" target="_blank" rel="noopener noreferrer"><code>gofmt</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> but then that idea ported to javascript with <a href="https://prettier.io/" target="_blank" rel="noopener noreferrer"><code>prettier</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>What it does is actually genius. It will compile your code down to the <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree" target="_blank" rel="noopener noreferrer">AST<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which is valid program devoid of whitespace, indents and other cruft. It then uses that to create your source code again in a consistent style that it produces the same AST!</p> <p>So to anyone that says &quot;I don't like things that change my code.&quot; Well, to a computer it hasn't changed.</p> <p>Łukasz Langa, worked in the same office as the author of <code>prettier</code> and created the equivalent program for python called <code>black</code>.</p> <p>Here is his PyCon2019 talk about how it works if you are interested.</p> <p><strong>Łukasz Langa, Life Is Better Painted Black, or: How to Stop Worrying and Embrace Auto-Formatting</strong></p> <iframe width="560" height="315" src="https://www.youtube.com/embed/esZLCuWs_2Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="allowfullscreen"></iframe> <p>To get up and running though it's simple:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pytest-black
pytest --black
</code></pre></div><p>Or in your <code>pytest.ini</code> or <code>tox.ini</code> add the following:</p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[pytest]</span>
<span class="token constant">addopts</span><span class="token attr-value"><span class="token punctuation">=</span></span>
  --black
</code></pre></div><h2 id="linting-and-static-analysis"><a href="#linting-and-static-analysis" aria-hidden="true" class="header-anchor">#</a> Linting and Static Analysis</h2> <p>Since Python is an interpretted language there is no formal compile step and a lot of errors don't appear until they are in production. Lucky for us static analysis is a very well understood field at this point and there are tools that will parse your code and look for patterns that exhibit a <em>code smell</em> whilst it is not running.</p> <p>Simple things like unused variables or import statements can be cleaned out.</p> <p>But more sophisticated issues like the <a href="https://en.wikipedia.org/wiki/Cyclomatic_complexity" target="_blank" rel="noopener noreferrer">Cyclomatic Complexity<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> of a function.</p> <p>We are using <a href="http://flake8.pycqa.org/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>flake8</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. However <a href="https://www.pylint.org/" target="_blank" rel="noopener noreferrer"><code>pylint</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a much more thorough tool but it also takes a full minute at minimum on even a small code base.</p> <p>There are a few articles that discuss why <code>pylint</code> is valuable but also the cost is speed.</p> <ul><li><a href="https://pythonspeed.com/articles/pylint/" target="_blank" rel="noopener noreferrer">Why Pylint is both useful and unusable, and how you can actually use it<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://stackoverflow.com/questions/51488322/why-pylint-is-too-slow-while-pep8-just-takes-a-second-to-check-the-same-code" target="_blank" rel="noopener noreferrer">Stackoverflow: Why Pylint is too slow while pep8 just takes a second to check the same code?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>In the process of trying to get it to run faster I uncovered another issue when trying to roll out code quality to an existing code base.</p> <blockquote><p>Q: How do you eat an elephant?
A: One mouthful at a time.</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> <span class="token function">diff</span> master<span class="token punctuation">..</span>HEAD --name-only
</code></pre></div><p>This will list all files that were changed in this branch (<code>HEAD</code>) relative to <code>master</code>.</p> <p>Whilst I would not recommend <code>pylint</code> on a day-to-day basis, I would recommend getting it's additional checks passing before opening a Pull Request.</p> <p>So we added a stage to our CI pipeline that only lints modified files:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pylint <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> <span class="token function">diff</span> master<span class="token punctuation">..</span>HEAD --name-only <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'\.py$'</span><span class="token variable">)</span></span>
</code></pre></div><p>Having come from a background of <a href="https://www.typescriptlang.org/" target="_blank" rel="noopener noreferrer">Typescript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and seeing the benefits of working on an incrementally typed code base, I intend to roll out the use of <a href="http://mypy-lang.org/" target="_blank" rel="noopener noreferrer"><code>mypy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Most likely using <em>only modified on this branch</em> trick to incrementally enforce it until we can use the <a href="https://pypi.org/project/pytest-mypy/" target="_blank" rel="noopener noreferrer"><code>pytest-mypy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> plugin.</p> <p>And this is the truly wonderful aspect of <code>pytest</code>, the use of plugins to tailor it to be the tool you need it to be and it's not bloated trying to be the tool you don't need.</p> <p>Lucky for us, <code>flake8</code> took the same approach and I have one more plugin <a href="https://pypi.org/project/flake8-docstrings/" target="_blank" rel="noopener noreferrer"><code>flake8-docstrings</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Just so you are following along:</p> <div class="language- extra-class"><pre class="language-text"><code>pytest --&gt; pytest-flake8 --&gt; flake8 --&gt; flake8-docstrings
</code></pre></div><p>It's plugins all the way down! Since docstrings are a language feature of Python they can be extracted and linted too! This plugin enforces the <a href="https://www.python.org/dev/peps/pep-0257/" target="_blank" rel="noopener noreferrer">PEP-257 Docstring Conventions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>So this is the extra code:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pytest-flake8 flake8-docstrings
pytest --flake8
</code></pre></div><p><code>tox.ini</code></p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[pytest]</span>
<span class="token constant">addopts</span> <span class="token attr-value"><span class="token punctuation">=</span> </span>
 --black
 --flake8

<span class="token selector">[flake8]</span>
<span class="token comment"># Default of 10 was too low for existing code base.</span>
<span class="token comment"># Ratcheted this up until existing code passes (20!)</span>
<span class="token comment"># Then each month dropped by 1 and have refactored back down to 15.</span>
<span class="token constant">max-complexity</span><span class="token attr-value"><span class="token punctuation">=</span>15</span>
</code></pre></div><p>Easy!</p> <h2 id="code-coverage"><a href="#code-coverage" aria-hidden="true" class="header-anchor">#</a> Code Coverage</h2> <p>Last section on automating code quality before we get into the meatier part of this article.</p> <p>For the longest time I did not appreciate the value of testing and code coverage until a series of 3am <a href="https://www.pagerduty.com/" target="_blank" rel="noopener noreferrer">PagerDuty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> events triggered and woke up me <em>and my wife</em>.</p> <p>Back to <em>being stuck between <strong>the boss</strong> and a not so hard place</em>.</p> <p>In my bleary eyed state I was manually running scripts to assert part of the system was or was not working as expected..... I was manually running tests. This could be automated, and so we did. We ran it early and ran it often. My wife and I have slept well since.</p> <blockquote><p>Q: So how much code coverage should I aim for?</p> <p>A: 0% isn't really cutting it at the moment.</p> <p>100% isn't practical or pragmatic.</p> <p>Less than 50% doesn't inspire much confidence either.</p> <p>So somewhere between 50-100% is our answer.</p></blockquote> <p>Back in <a href="#background-about-me">background about me</a> I mentioned that SalesForce enforces 75%. That means for every 4 lines of code, it is totally ok if one of them doesn't have test coverage. This is a calculated risk and thus the percentage should change depending on your situation.</p> <p>You can get a lot of code coverage from 3-4 tests. Think of how when taking an MRI scan of the brain they'll inject an die so they can see which paths light up. You can get pretty good coverage from one test and when you layer a few together you get a better idea of what is happening.</p> <p>I can usually hit 60-70% just by testing <em>The Happy Path</em> of code execution and a few of <em>The Sad Paths</em> of execution. If a bug crops up, well that is another sad path that you can add to your list of tests to cover.</p> <p>We are using the <a href="https://pytest-cov.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer"><code>pytest-cov</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> plugin that leverages the <a href="https://coverage.readthedocs.io/en/v4.5.x/" target="_blank" rel="noopener noreferrer"><code>coverage.py</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> tool.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pytest-cov
</code></pre></div><p>The configuration gets a bit hairy but just read my comments:
<code>tox.ini</code></p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[pytest]</span>
<span class="token constant">addopts</span> <span class="token attr-value"><span class="token punctuation">=</span> </span>
<span class="token comment"># Some other flags ommitted....</span>

<span class="token comment"># Test Report</span>
<span class="token constant">  --junitxml</span><span class="token attr-value"><span class="token punctuation">=</span>junit/test-results.xml</span>

<span class="token comment"># Code Coverage</span>
<span class="token constant">  --cov</span><span class="token attr-value"><span class="token punctuation">=</span>.</span>
  --cov-branch
<span class="token comment">  # --no-cov-on-fail</span>
  --cov-report xml:cov.xml
  --cov-report html:htmlcov
  --cov-report term
<span class="token comment">  # This value should be ratcheted up overtime as we get better coverage</span>
<span class="token comment">  # Set at it's lowest point to prevent regressions</span>
<span class="token constant">  --cov-fail-under</span><span class="token attr-value"><span class="token punctuation">=</span>68</span>

<span class="token comment">  # Target:</span>
<span class="token comment">  # --cov-fail-under=75</span>

<span class="token selector">[coverage:run]</span>
<span class="token constant">omit</span> <span class="token attr-value"><span class="token punctuation">=</span> </span>
  **/test_*.py
  **/__init__.py
</code></pre></div><p>And here is some sample output:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>│- generated xml file: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>jpeak<span class="token punctuation">\</span>projects<span class="token punctuation">\</span>kmap-python-lib<span class="token punctuation">\</span>junit<span class="token punctuation">\</span>test-results.xml -
│
│----------- coverage: platform win32, python <span class="token number">3.7</span>.3-final-0 -----------
│Name                         Stmts   Miss Branch BrPart  Cover
│--------------------------------------------------------------
│koala<span class="token punctuation">\</span>io<span class="token punctuation">\</span>api.py                  <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span>   <span class="token number">100</span>%
│koala<span class="token punctuation">\</span>io<span class="token punctuation">\</span>cache.py                <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span>   <span class="token number">100</span>%
│koala<span class="token punctuation">\</span>io<span class="token punctuation">\</span>config.py              <span class="token number">32</span>      <span class="token number">1</span>     <span class="token number">18</span>      <span class="token number">0</span>    <span class="token number">98</span>%
│koala<span class="token punctuation">\</span>io<span class="token punctuation">\</span>datawarehouse.py      <span class="token number">101</span>     <span class="token number">21</span>     <span class="token number">22</span>      <span class="token number">3</span>    <span class="token number">77</span>%
│koala<span class="token punctuation">\</span>io<span class="token punctuation">\</span>shorttermstore.py     <span class="token number">230</span>    <span class="token number">106</span>     <span class="token number">70</span>     <span class="token number">11</span>    <span class="token number">48</span>%
│--------------------------------------------------------------
│TOTAL                          <span class="token number">363</span>    <span class="token number">128</span>    <span class="token number">110</span>     <span class="token number">14</span>    <span class="token number">61</span>%
│Coverage HTML written to <span class="token function">dir</span> htmlcov
│Coverage XML written to <span class="token function">file</span> cov.xml
│
</code></pre></div><p>I'm currently working through the <code>shorttermstore</code> wrapper but when I worked through the <code>datawarehouse</code> code I realised something.</p> <blockquote><p>Increase code coverage by testing more code OR deleting code.</p></blockquote> <p>So I refactored a lot of repetitive code and reduced the total number of lines of code as well as branch paths (<code>Branch</code> and <code>BrPart</code>). I turned on <code>--cov-branch</code> to make getting that percentage harder and more realistic as lines of code can be gamed.</p> <p><a href="https://martinfowler.com/books/refactoring.html" target="_blank" rel="noopener noreferrer">Refactoring 2e - Martin Fowler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a recommended read, even if it is only the first 5 chapters as they are the most critical.</p> <p>Ok, deep breath. We made it this far and this is what I call the basics.</p> <p>It's ok.</p> <p>All of this, you setup at the start of a project or on an existing code base after you hire me.</p> <p>I also call it the basics because you can add these stages to any software project in any language, it's a matter of doing what I did and google each of the headings plus your language's name.</p> <p>Then it's automated and prompts you what to do when you haven't done it.</p> <p>But I'm glad you have read this far.</p> <h1 id="advanced-testing"><a href="#advanced-testing" aria-hidden="true" class="header-anchor">#</a> Advanced Testing</h1> <div align="center"><img src="/images/yo-dawg.jpg" alt="Yo Dawg Meme: Yo Dawg, We heard you like mocks; So we put some mocks in your mocks, and now you can mock mocks while you mocking." height="200"></div> <p>I've intentionally added a meme and some humour as a mental ad break as you may want to grab a coffee before the next section.</p> <p>I sure did.</p> <h2 id="fixtures"><a href="#fixtures" aria-hidden="true" class="header-anchor">#</a> Fixtures</h2> <p>The <a href="https://docs.pytest.org/en/latest/fixture.html" target="_blank" rel="noopener noreferrer"><code>pytest</code> Fixtures<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> documentation is actually really top quality.</p> <p>But I really appreciated walking through Ch 3, 4, 5, 7 of <a href="https://pragprog.com/book/bopytest/python-testing-with-pytest" target="_blank" rel="noopener noreferrer">Python testing with pytest - Brian Okken<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that covers Fixtures, Builtin Fixtures, Plugins and other tools.</p> <p>Lucky for you Prag Prog have a free excerpt from the <a href="http://media.pragprog.com/titles/bopytest/fixtures.pdf" target="_blank" rel="noopener noreferrer">Fixtures chapter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Remember this example from the <a href="#a-basic-test">start</a>?</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>config <span class="token keyword">import</span> Config
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>datawarehouse <span class="token keyword">import</span> DataWarehouse

<span class="token keyword">class</span> <span class="token class-name">TestDataWarehouse</span><span class="token punctuation">:</span>
    
    @pytest<span class="token punctuation">.</span>fixture
    <span class="token keyword">def</span> <span class="token function">dwh_config</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>


    @pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize<span class="token punctuation">(</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;NamesOnly&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;All&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_get_all_metrics</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dwh_config<span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Given</span>
        dwh <span class="token operator">=</span> DataWarehouse<span class="token punctuation">(</span>envir<span class="token operator">=</span>dwh_config<span class="token punctuation">)</span>

        <span class="token comment"># When</span>
        results <span class="token operator">=</span> dwh<span class="token punctuation">.</span>get_all_metrics<span class="token punctuation">(</span>name_only<span class="token operator">=</span>names<span class="token punctuation">)</span>

        <span class="token comment"># Then</span>
        <span class="token keyword">assert</span> results <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span>
</code></pre></div><p>The fixture decorator marks this method for special use within the pytest eco-system. Once it is marked and available, you reference it in a pytest method signature like a function argument.</p> <p>You can run the following to discover what fixtures are available:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pytest --fixtures
</code></pre></div><p>In our test suite at Komatsu, most of our tests need to be configured to connect to databases. So it makes sense to create a single spot where it is setup (and torn down) but leverage using it multiple times. Should the database not be available, the fixture will throw an <code>ERROR</code> to distinguish from your test <code>FAIL</code>ing.</p> <p>In the example above I use a <code>return</code> statement, but most fixtures will use a <code>yield</code> statement.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span>
<span class="token keyword">def</span> <span class="token function">db_connection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#Setup</span>
    conn <span class="token operator">=</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">yield</span> conn

    <span class="token comment"># Tear Down</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>yield</code> statements allow code to execute <strong>after</strong> the function initially returns. So when your test starts, it gets up to the <code>yield</code> line in your fixture, before your test method starts. Once your test method completes the remainder of the code executes.</p> <p>This is actually a really good segue to another useful plugin <a href="https://pypi.org/project/pytest-mock/" target="_blank" rel="noopener noreferrer"><code>pytest-mock</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> in the next section.</p> <h2 id="mocks-spies-stubs-and-monkey-patches"><a href="#mocks-spies-stubs-and-monkey-patches" aria-hidden="true" class="header-anchor">#</a> Mocks, Spies, Stubs and Monkey Patches</h2> <h3 id="monkey-patches"><a href="#monkey-patches" aria-hidden="true" class="header-anchor">#</a> Monkey Patches</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>config <span class="token keyword">import</span> Config

<span class="token keyword">class</span> <span class="token class-name">TestConfig</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">test_bracket_accessors</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> monkeypatch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># given</span>
        monkeypatch<span class="token punctuation">.</span>setenv<span class="token punctuation">(</span><span class="token string">&quot;KOALA_ENV&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pytest&quot;</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> Config<span class="token punctuation">(</span>require_only<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;KOALA_ENV&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># when</span>
        results <span class="token operator">=</span> <span class="token punctuation">[</span>c<span class="token punctuation">[</span><span class="token string">&quot;KOALA_ENV&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token string">&quot;koala_env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token string">&quot;Koala_Env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

        <span class="token comment"># then</span>
        <span class="token keyword">assert</span> results <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token string">&quot;pytest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pytest&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pytest&quot;</span><span class="token punctuation">]</span>

</code></pre></div><p>Our configuration class abides by the tenets of <a href="https://12factor.net/config" target="_blank" rel="noopener noreferrer">Twelve Factor Apps: Config<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and expects configuration to be defined as environment variables.</p> <p>I was using <code>os.environ</code> directly but then that was modifying my global state and subesquent tests were not reliable, (and neither was my computer!).</p> <p>The thing is when I ran <code>pytest koala/io/tests/test_config.py</code> for quick iterations it worked but when I ran <code>pytest</code> for the whole suite it broke. My tests only worked because of the order they ran and I would have found this earlier if I'd used <a href="https://pypi.org/project/pytest-randomly/" target="_blank" rel="noopener noreferrer"><code>pytest-randomly</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which randomises the ordering of test execution.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pytest-randomly
</code></pre></div><p>So I would have found this sooner, but how do I fix it? Well pytest has a builtin fixture for <a href="https://docs.pytest.org/en/latest/monkeypatch.html#monkeypatching-environment-variables" target="_blank" rel="noopener noreferrer">monkeypatching<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> even with an example monkey patching environment variables.</p> <blockquote><p>Hold on! What is this Monkey business?</p></blockquote> <p>A monkey patch is a way to temporarily modify system behaviour.</p> <div class="language-python extra-class"><pre class="language-python"><code>monkeypatch<span class="token punctuation">.</span>setenv<span class="token punctuation">(</span><span class="token string">&quot;KOALA_ENV&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pytest&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>This line ensures that for the duration of this test <strong>AND ONLY THIS TEST</strong> <code>os.environ[&quot;KOALA_ENV&quot;]</code> will return <code>&quot;pytest&quot;</code>.</p> <h3 id="mocks"><a href="#mocks" aria-hidden="true" class="header-anchor">#</a> Mocks</h3> <p>I mentioned <a href="https://pypi.org/project/pytest-mock/" target="_blank" rel="noopener noreferrer"><code>pytest-mock</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, this uses the same principle of adding a fixture (<code>mocker</code> in this case) that will automatically clean up your testing state. It includes monkey patching and some convenience methods for creating mocks, stubs and spies.</p> <p>A <a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank" rel="noopener noreferrer"><code>Mock</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is a very special Python object that you can swap it in for any other class, function or method and it will accept any method calls.</p> <p>In it's default state it will do absolutely nothing at this point but let you capture <em>how</em> a method was called and <em>how many times</em> it was called. This gives us the option to design tests around these properties.</p> <h3 id="stubs"><a href="#stubs" aria-hidden="true" class="header-anchor">#</a> Stubs</h3> <p>Stubs are like using a mock but you are usually returning a hard coded value instead of using the real method. Think of using a payment portal, you don't want to test sending money all the time but you want to test how your code behaves after it returns a value.</p> <p>You can compose tests using the <a href="http://doc.pytest.org/en/latest/parametrize.html" target="_blank" rel="noopener noreferrer">parametrizing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> we mentioned earlier that can iterate through a hard coded list of scenarios that could return and put your response handlers through their motions.</p> <h3 id="spies"><a href="#spies" aria-hidden="true" class="header-anchor">#</a> Spies</h3> <p>I personally think Spies are genius when you see how <a href="https://pypi.org/project/pytest-mock/" target="_blank" rel="noopener noreferrer"><code>pytest-mock</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> implement them in <a href="https://github.com/pytest-dev/pytest-mock/blob/master/pytest_mock.py#L107" target="_blank" rel="noopener noreferrer"><code>mocker.spy()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>It is a Mock with a <code>side_effect</code> of running the actual code.</p> <p>So you can inject a spy into the flow of your normal code and access these extra execution properties about how often it was called and the history of arguments used to call it.</p> <h2 id="be-kind-and-rewind"><a href="#be-kind-and-rewind" aria-hidden="true" class="header-anchor">#</a> Be Kind and Rewind</h2> <p>Now that I have laid out all of that foundational knowledge, and to be honest it was a truck load that took me months to ramp up to we add these lines:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>pip <span class="token function">install</span> pytest-vcr
</code></pre></div><p><code>tox.ini</code></p> <div class="language-ini extra-class"><pre class="language-ini"><code><span class="token selector">[pytest]</span>
<span class="token constant">addopts</span> <span class="token attr-value"><span class="token punctuation">=</span> </span>
<span class="token comment"># PyVCR: HTTP Requests Fixture</span>
<span class="token constant">  --vcr-record</span><span class="token attr-value"><span class="token punctuation">=</span>none</span>
<span class="token comment"># ... other flags ...</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pytest
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>config <span class="token keyword">import</span> Config
<span class="token keyword">from</span> koala<span class="token punctuation">.</span>io<span class="token punctuation">.</span>datawarehouse <span class="token keyword">import</span> DataWarehouse

VCR_ARGS <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>
    filter_headers<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
    match_on<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;method&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;scheme&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;host&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;port&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;query&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;headers&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;body&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestDataWarehouse</span><span class="token punctuation">:</span>
    
    @pytest<span class="token punctuation">.</span>fixture
    <span class="token keyword">def</span> <span class="token function">dwh_config</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>


    @pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>vcr<span class="token punctuation">(</span><span class="token operator">**</span>VCR_ARGS<span class="token punctuation">)</span>
    @pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize<span class="token punctuation">(</span><span class="token string">&quot;names&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;NamesOnly&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;All&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">test_get_all_metrics</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dwh_config<span class="token punctuation">,</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Given</span>
        dwh <span class="token operator">=</span> DataWarehouse<span class="token punctuation">(</span>envir<span class="token operator">=</span>dwh_config<span class="token punctuation">)</span>

        <span class="token comment"># When</span>
        results <span class="token operator">=</span> dwh<span class="token punctuation">.</span>get_all_metrics<span class="token punctuation">(</span>name_only<span class="token operator">=</span>names<span class="token punctuation">)</span>

        <span class="token comment"># Then</span>
        <span class="token keyword">assert</span> results <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>results<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span>

</code></pre></div><p>Thanks to some <em>Twitter Driven Development</em> I ran into <a href="https://pypi.org/project/pytest-vcr/" target="_blank" rel="noopener noreferrer"><code>pytest-vcr</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which achieved what I needed to test our API wrappers in 4 lines of code (depending how you count it).</p> <p>The decorator <code>@pytest.mark.vcr</code> is all we need really. It creates a fixture that intercepts all HTTP traffic to our APIs only for the duration of a test. That is all requests and responses and I found out that some methods were making 3 API requests in a single test!</p> <p>In our <code>tox.ini</code> I set the default flag to <code>--vcr-record=none</code> but initially I need to use <code>--vcr-record=once</code> so it will save YAML files next to my test so it can be replayed.</p> <p>The fact that I now have a cache makes these tests 10x faster not being blocked on network IO.</p> <p>Now lets look at the <code>VCR_ARGS</code> constant. VCR saves <em>all</em> headers unless you <code>filter_headers</code> and in particular the <code>Authorization</code> header. Since I'm committing these YAML files to version control I do not want to store sensitive data. You should also filter out headers that are not test invariants, eg features that should reliably be properties of this request everytime like <code>nonce</code>s.</p> <p>In our CI system the default behaviour uses the <code>--vcr-record=none</code>, which means VCR tries to match with existing YAML files and record no new requests.</p> <p>The default matcher when looking up locally does not include matching the <code>headers</code> and <code>body</code>, so I have enabled these in the <code>match_on</code> initialisation.</p> <p>Now, I can get <code>pytest-vcr</code> to throw errors if there is a regression in how I compose a request! If it is a valid change to that test behaviour, I'll delete the YML file and record a new one.</p> <p>This is the same idea behind <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> where it takes snapshots of rendered Web Components as a snapshot reference for testing.</p> <p>The part that VCR snapshot go beyond is that we essentially recorded stub data too so I can test the response handlers. I can copy a YML file and edit it to manually introduce response errors to test other pathways.</p> <p>Now I'm only 24 hours into using <code>pytest-vcr</code> and have a lot more to discover but what I'd like to see is the same sort of <a href="https://github.com/pytest-dev/pytest-mock/#improved-reporting-of-mock-call-assertion-errors" target="_blank" rel="noopener noreferrer">improved reporting of call assertions<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> from <code>pytest-mock</code> when a request doesn't match locally but reports the diff of the nearest match.</p> <p>Who knows, it might be a setting I'm missing, or it might mean I open a Pull Request.</p> <p>Before I wrap up this section though I'd like to mention some plugins that were mentioned on twitter in this space:</p> <ul><li><a href="https://github.com/syrusakbary/snapshottest" target="_blank" rel="noopener noreferrer">Snapshot test<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/getsentry/pytest-responses" target="_blank" rel="noopener noreferrer">pytest-responses<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><strong>UPDATE #1:</strong></p> <p>After writing and publishing this article I found a deep and exhaustive collection of articles at <a href="https://pythonspeed.com" target="_blank" rel="noopener noreferrer">Python Speed<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. In particular this one discussing the topic of <em>Verified Fakes</em> which is kindof what <a href="https://pypi.org/project/pytest-vcr/" target="_blank" rel="noopener noreferrer"><code>pytest-vcr</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> is achieving around the python http library.</p> <ul><li><a href="https://pythonspeed.com/articles/verified-fakes/" target="_blank" rel="noopener noreferrer">Verified Fakes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p><strong>UPDATE #2:</strong></p> <p>In an effort to create a local plugin to override the default exception thrown I went down <a href="https://stackoverflow.com/questions/56745834/python-pytest-pytest-exception-interact-customize-exception-information-from-vcr" target="_blank" rel="noopener noreferrer">this rabbit hole on stackoverflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>And subsequently opened <a href="https://github.com/kevin1024/vcrpy/pull/445" target="_blank" rel="noopener noreferrer">this pull request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>So I can use the standard library <a href="https://docs.python.org/3/library/difflib.html" target="_blank" rel="noopener noreferrer"><code>difflib</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to create a diff of why the attempted request did not match the recorded request for that specific test.</p> <p><strong>UPDATE #3:</strong></p> <p>In a weird turn of events I finally managed to <a href="https://stackoverflow.com/a/56828754/622276" target="_blank" rel="noopener noreferrer">answer my question on stackoverflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>In the mean time I met <a href="https://github.com/arthurHamon2" target="_blank" rel="noopener noreferrer"><code>arthurHamon2</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> who was attempting to do the same thing in <a href="https://github.com/kevin1024/vcrpy/pull/439" target="_blank" rel="noopener noreferrer">PR #439<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> of <a href="https://vcrpy.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>vcrpy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>Also <code>kevin1024</code> granted myself and <code>arthurHamon2</code> maintainer privileges.</p> <p>And finally... there was a bug only showing on CI and not on local dev. Turns out our timestamp functions were using the system timezone and converting it in ways we weren't expecting and would never have known if we were not doing this sort of reproducible testing.</p> <h1 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h1> <p>Code quality plugins like <a href="https://github.com/shopkeep/pytest-black" target="_blank" rel="noopener noreferrer"><code>pytest-black</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> and <a href="https://pypi.org/project/pytest-flake8/" target="_blank" rel="noopener noreferrer"><code>pytest-flake8</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> automatically add source files as a linting test that will fail CI but also skip the test if that file hasn't been modified between runs. This caching drops the first test run from 71 seconds to 44 seconds.</p> <p>With the help of <a href="https://pypi.org/project/pytest-xdist/" target="_blank" rel="noopener noreferrer"><code>pytest-xdist</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> I was able to spread our tests across multiple processes and reduced our total test suite time from 44 seconds to 14 seconds.</p> <p>With the help of the <a href="https://pypi.org/project/pytest-vcr/" target="_blank" rel="noopener noreferrer"><code>pytest-vcr</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> plugin I was able to mock out our HTTP traffic in our API test wrappers. This cached response reduced the tests from 14 seconds to 1.4 seconds.</p> <p>So reducing cycle time to answer questions means we can learn faster. The time it takes for your team to triage bugs and assert truths and expectations means other tasks come down from weeks to days or hours to seconds.</p> <p><strong>BONUS:</strong> We were able to detect a rather subtle bug because of the snapshot testing (and newly improved diffing features) of <a href="https://vcrpy.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>vcrpy</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>Have fun testing!</p> <h1 id="references"><a href="#references" aria-hidden="true" class="header-anchor">#</a> References</h1> <h2 id="tools"><a href="#tools" aria-hidden="true" class="header-anchor">#</a> Tools</h2> <ul><li><a href="https://doc.pytest.org/" target="_blank" rel="noopener noreferrer">Pytest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://tox.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">Tox<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://black.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer">Black<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://flake8.pycqa.org/en/latest/index.html" target="_blank" rel="noopener noreferrer">Flake8<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://coverage.readthedocs.io/en/v4.5.x/" target="_blank" rel="noopener noreferrer">Coverage.py<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.pipenv.org/" target="_blank" rel="noopener noreferrer">pipenv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://mypy-lang.org/" target="_blank" rel="noopener noreferrer">mypy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="pytest-plugins"><a href="#pytest-plugins" aria-hidden="true" class="header-anchor">#</a> Pytest Plugins</h2> <ul><li><a href="https://github.com/shopkeep/pytest-black" target="_blank" rel="noopener noreferrer"><code>pytest-black</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Enforce formatting style <a href="https://black.readthedocs.io/en/stable/" target="_blank" rel="noopener noreferrer"><code>black</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as a test</li> <li><a href="https://pypi.org/project/pytest-flake8/" target="_blank" rel="noopener noreferrer"><code>pytest-flake8</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Enforce linting standard <a href="http://flake8.pycqa.org/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>flake8</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as a test</li> <li><a href="https://pytest-cov.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer"><code>pytest-cov</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Measure and enforce code coverage (&gt; 75%) <a href="https://coverage.readthedocs.io/en/v4.5.x/" target="_blank" rel="noopener noreferrer"><code>coverage.py</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pypi.org/project/pytest-mock/" target="_blank" rel="noopener noreferrer"><code>pytest-mock</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Test fixture to assist mocking and monkey patching</li> <li><a href="https://pypi.org/project/pytest-vcr/" target="_blank" rel="noopener noreferrer"><code>pytest-vcr</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Record and replay HTTP requests as a test fixture (<a href="https://vcrpy.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer"><code>VCR.py</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</li> <li><a href="https://pypi.org/project/pytest-randomly/" target="_blank" rel="noopener noreferrer"><code>pytest-randomly</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Run tests in random order to detect leaking global state</li> <li><a href="https://pypi.org/project/pytest-xdist/" target="_blank" rel="noopener noreferrer"><code>pytest-xdist</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Distribute tests across multiple CPU cores (or compute nodes)</li></ul> <p>Others but untested:</p> <ul><li><a href="https://github.com/syrusakbary/snapshottest" target="_blank" rel="noopener noreferrer">Snapshot test<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: Inspired by <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">Jest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/getsentry/pytest-responses" target="_blank" rel="noopener noreferrer"><code>pytest-responses</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>: pytest fixture for mocking out the requests library</li></ul> <h2 id="podcasts-2"><a href="#podcasts-2" aria-hidden="true" class="header-anchor">#</a> Podcasts</h2> <ul><li><a href="https://talkpython.fm/" target="_blank" rel="noopener noreferrer">Talk Python To Me<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://testandcode.com/" target="_blank" rel="noopener noreferrer">Test and Code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://pythonbytes.fm/" target="_blank" rel="noopener noreferrer">Python Bytes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="books"><a href="#books" aria-hidden="true" class="header-anchor">#</a> Books</h2> <ul><li><a href="https://pragprog.com/book/bopytest/python-testing-with-pytest" target="_blank" rel="noopener noreferrer">Python Testing with pytest - Brian Okken (Pragmatic Programmer Publishing)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="articles"><a href="#articles" aria-hidden="true" class="header-anchor">#</a> Articles</h2> <ul><li><a href="https://realpython.com/" target="_blank" rel="noopener noreferrer">Real Python<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <ul><li><a href="https://realpython.com/pypi-publish-python-package/" target="_blank" rel="noopener noreferrer">Real Python: Packaging a Python Library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://realpython.com/pipenv-guide/" target="_blank" rel="noopener noreferrer">Real Python: A guide to Pipenv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://realpython.com/python-testing/#testing-in-multiple-environments" target="_blank" rel="noopener noreferrer">Real Python: Automated Testing - Multiple Environments<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://realpython.com/python-mock-library/" target="_blank" rel="noopener noreferrer">Real Python: Python Mock Library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/28/2019, 3:33:09 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9eca36fc.js" defer></script><script src="/assets/js/2.5a99314c.js" defer></script><script src="/assets/js/14.49a54d24.js" defer></script>
  </body>
</html>
